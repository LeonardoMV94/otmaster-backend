var Ce=Object.defineProperty,Ve=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var ee=Object.getOwnPropertySymbols;var Se=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;var te=(t,s,r)=>s in t?Ce(t,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[s]=r,O=(t,s)=>{for(var r in s||(s={}))Se.call(s,r)&&te(t,r,s[r]);if(ee)for(var r of ee(s))Ee.call(s,r)&&te(t,r,s[r]);return t},G=(t,s)=>Ve(t,Te(s));import{bD as ve,bE as Ae,cf as Pe,bG as xe,n as A,V as P,cg as Re,bI as Qe,ch as Oe,bK as Ue,ci as Ie,a_ as oe,aq as ae,bB as le,bw as ie,bX as De,ae as X,b8 as Be,ab as qe,bO as Ne,bC as je,b$ as He,a5 as Me,ca as Ke,ap as Le,ao as $e,aA as We,Y as Ge,a4 as o,b3 as l,cj as ne,z as c,j as se,ck as ze,cl as Fe,cm as Xe,Z as re,G as d,cn as Ye,b5 as ue,bS as D,co as B,bR as de,a3 as m,bq as z,br as Ze}from"./index.6be16f63.js";import{u as Je,v as ce,a as et,p as me,b as tt,c as ot,r as fe,s as at,d as lt,Q as it,e as nt,f as k,g as q,h as st,i as rt,C as be}from"./ClosePopup.d0a73f30.js";import{c as ge,b as ut,Q as dt}from"./QItem.1a96ea91.js";import{c as ct}from"./Notifications.d579e4b1.js";import{u as mt}from"./useAuth.5537e7f8.js";import{u as ft}from"./useTickets.44dbacae.js";import{u as bt}from"./useCliente.418f2896.js";import{u as gt}from"./useColaboradores.c87e1ace.js";var F=ve({name:"QTooltip",inheritAttrs:!1,props:G(O(O(O({},Je),Ae),Pe),{maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:ce},self:{type:String,default:"top middle",validator:ce},offset:{type:Array,default:()=>[14,14],validator:et},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}}),emits:[...xe],setup(t,{slots:s,emit:r,attrs:y}){let v,w;const x=qe(),{proxy:{$q:g}}=x,T=A(null),_=A(!1),N=P(()=>me(t.anchor,g.lang.rtl)),j=P(()=>me(t.self,g.lang.rtl)),h=P(()=>t.persistent!==!0),{registerTick:p,removeTick:E}=Re(),{registerTimeout:C,removeTimeout:R}=Qe(),{transition:H,transitionStyle:M}=Oe(t,_),{localScrollTarget:U,changeScrollEvent:K,unconfigureScrollTarget:L}=tt(t,Z),{anchorEl:f,canShow:$,anchorEvents:V}=ot({showing:_,configureAnchorEl:we}),{show:I,hide:i}=Ue({showing:_,canShow:$,handleShow:b,handleHide:_e,hideOnRouteChange:h,processOnMount:!0});Object.assign(V,{delayShow:ke,delayHide:ye});const{showPortal:n,hidePortal:e,renderPortal:a}=Ie(x,T,pe);if(g.platform.is.mobile===!0){const u={anchorEl:f,innerRef:T,onClickOutside(S){return i(S),S.target.classList.contains("q-dialog__backdrop")&&je(S),!0}},W=P(()=>t.modelValue===null&&t.persistent!==!0&&_.value===!0);oe(W,S=>{(S===!0?lt:fe)(u)}),ae(()=>{fe(u)})}function b(u){E(),R(),n(),p(()=>{w=new MutationObserver(()=>Q()),w.observe(T.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),Q(),Z()}),v===void 0&&(v=oe(()=>g.screen.width+"|"+g.screen.height+"|"+t.self+"|"+t.anchor+"|"+g.lang.rtl,Q)),C(()=>{n(!0),r("show",u)},t.transitionDuration)}function _e(u){E(),R(),e(),Y(),C(()=>{e(!0),r("hide",u)},t.transitionDuration)}function Y(){w!==void 0&&(w.disconnect(),w=void 0),v!==void 0&&(v(),v=void 0),L(),le(V,"tooltipTemp")}function Q(){const u=T.value;f.value===null||!u||at({el:u,offset:t.offset,anchorEl:f.value,anchorOrigin:N.value,selfOrigin:j.value,maxHeight:t.maxHeight,maxWidth:t.maxWidth})}function ke(u){if(g.platform.is.mobile===!0){ge(),document.body.classList.add("non-selectable");const W=f.value,S=["touchmove","touchcancel","touchend","click"].map(J=>[W,J,"delayHide","passiveCapture"]);ie(V,"tooltipTemp",S)}C(()=>{I(u)},t.delay)}function ye(u){R(),g.platform.is.mobile===!0&&(le(V,"tooltipTemp"),ge(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),C(()=>{i(u)},t.hideDelay)}function we(){if(t.noParentEvent===!0||f.value===null)return;const u=g.platform.is.mobile===!0?[[f.value,"touchstart","delayShow","passive"]]:[[f.value,"mouseenter","delayShow","passive"],[f.value,"mouseleave","delayHide","passive"]];ie(V,"anchor",u)}function Z(){if(f.value!==null||t.scrollTarget!==void 0){U.value=De(f.value,t.scrollTarget);const u=t.noParentEvent===!0?Q:i;K(U.value,u)}}function he(){return _.value===!0?X("div",G(O({},y),{ref:T,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",y.class],style:[y.style,M.value],role:"complementary"}),Ne(s.default)):null}function pe(){return X(Be,{name:H.value,appear:!0},he)}return ae(Y),Object.assign(x.proxy,{updatePosition:Q}),a}});const vt=["top","middle","bottom"];var _t=ve({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:t=>vt.includes(t)}},setup(t,{slots:s}){const r=P(()=>t.align!==void 0?{verticalAlign:t.align}:null),y=P(()=>{const v=t.outline===!0&&t.color||t.textColor;return`q-badge flex inline items-center no-wrap q-badge--${t.multiLine===!0?"multi":"single"}-line`+(t.outline===!0?" q-badge--outline":t.color!==void 0?` bg-${t.color}`:"")+(v!==void 0?` text-${v}`:"")+(t.floating===!0?" q-badge--floating":"")+(t.rounded===!0?" q-badge--rounded":"")+(t.transparent===!0?" q-badge--transparent":"")});return()=>X("div",{class:y.value,style:r.value,role:"alert","aria-label":t.label},He(s.default,t.label!==void 0?[t.label]:[]))}});const kt={class:"q-pa-md"},yt={class:"q-ml-sm"},wt={class:"text-pre-wrap"},ht=m(" No hay estados "),Rt={__name:"TableEdit",setup(t){const s=Me(()=>Ke(()=>import("./FormTicket.c3b1fb75.js"),["assets/FormTicket.c3b1fb75.js","assets/FormTicket.de58472d.css","assets/QItem.1a96ea91.js","assets/index.6be16f63.js","assets/index.d6902eec.css","assets/ClosePopup.d0a73f30.js","assets/QForm.99f3ffd3.js","assets/useCliente.418f2896.js","assets/useColaboradores.c87e1ace.js","assets/Notifications.d579e4b1.js","assets/useDispositivo.a5f8053d.js","assets/useTickets.44dbacae.js"])),{isAdmin:r}=mt(),{getClienteByRut:y}=bt(),{getAllColaboradores:v,getColabByRut:w}=gt(),{getAllTickets:x,deleteTicket:g,getTickets:T,updateTicket:_,getAllEstados:N,getEstadosSelects:j}=ft();let h=A(!1),p=A(!1),E=A(null);const C=A(""),R=()=>{h.value=!h.value},H=i=>{E.value=i,p.value=!p.value},M=[{name:"id_ticket",align:"center",label:"ID Ticket",field:"ticket",sortable:!0},{name:"clientesRutCliente",align:"center",label:"Cliente",field:"clienteAtendido",sortable:!0},{name:"colaboradoresRutColaborador",align:"center",label:"Qui\xE9n Atendi\xF3",field:"colaboradorAtiende",sortable:!0},{name:"dispositivosIdDispositivo",align:"center",label:"Dispositivo",field:"dispositivoAtendido",sortable:!0},{name:"problema_ticket",align:"center",label:"Problema (Editable)",field:"problemaTicket",sortable:!0},{name:"diagnostico_ticket",align:"center",label:"Dign\xF3stico (Editable)",field:"diagnosticoTicket",sortable:!0},{name:"resolucion_ticket",align:"center",label:"Resoluci\xF3n (Editable)",field:"resolucionTicket",sortable:!0},{name:"estado_ticket",align:"center",label:"Estado",field:"estadoTicket",sortable:!0},{name:"items.repuesto",align:"center",label:"Repuestos",field:"items.repuesto",sortable:!0},{name:"acciones",label:"Acciones",field:"acciones",align:"center"}],U=async(i,n)=>{const e={problema_ticket:n};console.log("editarItemProblema",i,e),await _(i,e)},K=async(i,n)=>{const e={diagnostico_ticket:n};console.log("editarItemDiagnostico",i,e),await _(i,e)},L=async(i,n)=>{const e={resolucion_ticket:n};console.log("editarItemResolucion",i,e),await _(i,e)},f=async(i,n)=>{const e={estado_ticket:n};console.log("editarItemResolucion",i,e),await _(i,e)},$=async i=>{r?(console.log("delete permitido",i),await g(i)):(console.log("no hay permisos"),ct("No tiene permisos de Administrador para eliminar","negative"))},V=[{estado:"Abierto",color:"green"},{estado:"En Progreso",color:"yellow"},{estado:"Terminado",color:"blue"},{estado:"Cancelado",color:"red"}],I=async()=>{await x(),await v(),await N()};return Le(async()=>{await I()}),$e(async()=>{await I()}),(i,n)=>(We(),Ge("div",kt,[o(rt,{title:"Administraci\xF3n de Tickets",rows:c(T),columns:M,filter:C.value,"row-key":"name","binary-state-sort":""},{top:l(()=>[o(ne,{modelValue:c(h),"onUpdate:modelValue":n[0]||(n[0]=e=>se(h)?h.value=e:h=e)},{default:l(()=>[o(c(s))]),_:1},8,["modelValue"]),o(ne,{modelValue:c(p),"onUpdate:modelValue":n[2]||(n[2]=e=>se(p)?p.value=e:p=e),persistent:""},{default:l(()=>[o(ze,{class:""},{default:l(()=>[o(Fe,{class:"row items-center"},{default:l(()=>[o(Xe,{icon:"warning",color:"warning","text-color":"white"}),re("span",yt,"\xBFEst\xE1s seguro de eliminar el ticket n\xBA "+d(c(E))+"?",1)]),_:1}),o(Ye,{align:"right"},{default:l(()=>[ue(o(D,{flat:"",label:"Cancelar",color:"primary"},null,512),[[be]]),ue(o(D,{flat:"",label:"Confirmar",color:"negative",onClick:n[1]||(n[1]=e=>$(c(E)))},null,512),[[be]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(D,{color:"primary",label:"A\xF1adir Ticket",icon:"add",onClick:R}),o(it),o(B,{modelValue:C.value,"onUpdate:modelValue":n[3]||(n[3]=e=>C.value=e),outlined:"",dense:"",debounce:"300",color:"primary"},{append:l(()=>[o(de,{name:"search"})]),_:1},8,["modelValue"])]),body:l(e=>[o(nt,{props:e},{default:l(()=>[o(k,{key:"id_ticket",props:e},{default:l(()=>[m(d(e.row.id_ticket),1)]),_:2},1032,["props"]),o(k,{key:"clientesRutCliente",props:e},{default:l(()=>[m(d(e.row.clientesRutCliente)+" ",1),o(F,null,{default:l(()=>[m(d(c(y)(e.row.clientesRutCliente).nombre_cliente)+" "+d(c(y)(e.row.clientesRutCliente).appat_cliente)+" "+d(c(y)(e.row.clientesRutCliente).apmat_cliente),1)]),_:2},1024)]),_:2},1032,["props"]),o(k,{key:"colaboradoresRutColaborador",props:e},{default:l(()=>[re("div",wt,[m(d(e.row.colaboradoresRutColaborador)+" ",1),o(F,null,{default:l(()=>[m(d(c(w)(e.row.colaboradoresRutColaborador).nombre_colaborador)+" "+d(c(w)(e.row.colaboradoresRutColaborador).appat_colaborador)+" "+d(c(w)(e.row.colaboradoresRutColaborador).apmat_colaborador),1)]),_:2},1024)])]),_:2},1032,["props"]),o(k,{key:"dispositivosIdDispositivo",props:e},{default:l(()=>{var a;return[m(d(((a=e.row.dispositivos)==null?void 0:a.num_serie_dispositivo)||"Nulo")+" ",1),o(F,null,{default:l(()=>{var b;return[m(d(((b=e.row.dispositivos)==null?void 0:b.modelo)||"Nulo"),1)]}),_:2},1024)]}),_:2},1032,["props"]),o(k,{key:"problema_ticket",props:e},{default:l(()=>[m(d(e.row.problema_ticket)+" ",1),o(q,{modelValue:e.row.problema_ticket,"onUpdate:modelValue":a=>e.row.problema_ticket=a,title:"Editar Problema",buttons:"",persistent:"",onSave:a=>U(e.row.id_ticket,a)},{default:l(a=>[o(B,{modelValue:a.value,"onUpdate:modelValue":b=>a.value=b,type:"textarea",autofocus:"",counter:"",onKeyup:n[4]||(n[4]=z(Ze(()=>{},["stop"]),["enter"]))},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["props"]),o(k,{key:"diagnostico_ticket",props:e},{default:l(()=>[m(d(e.row.diagnostico_ticket)+" ",1),o(q,{modelValue:e.row.diagnostico_ticket,"onUpdate:modelValue":a=>e.row.diagnostico_ticket=a,title:"Editar diagn\xF3stico",buttons:"",persistent:"",onSave:a=>K(e.row.id_ticket,a)},{default:l(a=>[o(B,{modelValue:a.value,"onUpdate:modelValue":b=>a.value=b,autofocus:"",type:"textarea",counter:"",onKeyup:z(a.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["props"]),o(k,{key:"resolucion_ticket",props:e},{default:l(()=>[m(d(e.row.resolucion_ticket)+" ",1),o(q,{modelValue:e.row.resolucion_ticket,"onUpdate:modelValue":a=>e.row.resolucion_ticket=a,title:"Editar resoluci\xF3n",buttons:"",persistent:"",onSave:a=>L(e.row.id_ticket,a)},{default:l(a=>[o(B,{modelValue:a.value,"onUpdate:modelValue":b=>a.value=b,autofocus:"",type:"textarea",counter:"",onKeyup:z(a.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["props"]),o(k,{key:"estado_ticket",props:e},{default:l(()=>[o(_t,{color:V[e.row.estado_ticket-1].color},{default:l(()=>[m(d(V[e.row.estado_ticket-1].estado)+" ",1),o(q,{modelValue:e.estado_ticket,"onUpdate:modelValue":a=>e.estado_ticket=a,title:"Editar estado de ticket",buttons:"",persistent:"",onSave:a=>f(e.row.id_ticket,a.value)},{default:l(a=>[o(st,{modelValue:a.value,"onUpdate:modelValue":b=>a.value=b,outlined:"","label-color":"primary","input-debounce":"0","map-options":"",behavior:"menu",options:c(j)},{"no-option":l(()=>[o(ut,null,{default:l(()=>[o(dt,{class:"text-grey"},{default:l(()=>[ht]),_:1})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),_:2},1032,["modelValue","onUpdate:modelValue","onSave"])]),_:2},1032,["color"])]),_:2},1032,["props"]),o(k,{key:"items.repuesto",props:e},{default:l(()=>[m(d(e.row.items.map(a=>a.repuesto)),1)]),_:2},1032,["props"]),o(k,{key:"acciones",props:e},{default:l(()=>[o(D,{push:"",round:"",color:"red",onClick:a=>H(e.row.id_ticket)},{default:l(()=>[o(de,{name:"delete"})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","filter"])]))}};export{Rt as default};
