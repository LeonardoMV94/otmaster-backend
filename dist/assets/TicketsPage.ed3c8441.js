var je=Object.defineProperty,Me=Object.defineProperties;var Ie=Object.getOwnPropertyDescriptors;var ie=Object.getOwnPropertySymbols;var He=Object.prototype.hasOwnProperty,Ke=Object.prototype.propertyIsEnumerable;var se=(e,a,l)=>a in e?je(e,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[a]=l,j=(e,a)=>{for(var l in a||(a={}))He.call(a,l)&&se(e,l,a[l]);if(ie)for(var l of ie(a))Ke.call(a,l)&&se(e,l,a[l]);return e},F=(e,a)=>Me(e,Ie(a));import{Q as Ne}from"./QPage.3ce65134.js";import{bD as K,V as P,ae as x,bO as N,ab as J,bE as $e,cl as Le,bG as Fe,n as y,cm as We,bI as ze,cn as Ge,bK as Xe,co as Ye,a_ as re,aq as ue,bB as ce,bw as de,bX as Ze,b8 as Je,bC as et,cK as tt,cz as ot,an as lt,bS as B,b$ as at,bs as nt,cP as it,cQ as st,c7 as rt,cd as ut,ap as we,ao as ke,aA as ee,Y as Ce,a4 as o,b3 as n,Z as T,z as g,bR as I,ce as M,cN as Ve,aD as ct,aB as dt,a3 as h,cA as fe,j as ve,cR as ft,cS as vt,G as _,cT as mt,b5 as me,bq as W,W as bt}from"./index.5404b0db.js";import{u as pt,v as be,c as _t,p as pe,d as gt,e as ht,r as _e,s as yt,f as wt,g as kt,b as z,Q as Ct,a as Vt}from"./QTable.d145fbc0.js";import{c as ge,b as G,Q as X}from"./QItem.1864d98b.js";import{Q as Tt}from"./QForm.5d83addf.js";import{u as Te}from"./useCliente.b70220ac.js";import{u as Se}from"./useColaboradores.03c91537.js";import{u as St}from"./useDispositivo.cbf486f3.js";import{u as xe}from"./useTickets.466e2b9e.js";import{c as xt}from"./Notifications.cd9f2894.js";import{u as qt}from"./useAuth.f03cbf5f.js";function H(e,a=new WeakMap){if(Object(e)!==e)return e;if(a.has(e))return a.get(e);const l=e instanceof Date?new Date(e):e instanceof RegExp?new RegExp(e.source,e.flags):e instanceof Set?new Set:e instanceof Map?new Map:typeof e.constructor!="function"?Object.create(null):e.prototype!==void 0&&typeof e.prototype.constructor=="function"?e:new e.constructor;if(typeof e.constructor=="function"&&typeof e.valueOf=="function"){const i=e.valueOf();if(Object(i)!==i){const s=new e.constructor(i);return a.set(e,s),s}}return a.set(e,l),e instanceof Set?e.forEach(i=>{l.add(H(i,a))}):e instanceof Map&&e.forEach((i,s)=>{l.set(s,H(i,a))}),Object.assign(l,...Object.keys(e).map(i=>({[i]:H(e[i],a)})))}var O=K({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(e,{slots:a}){const l=J(),i=P(()=>"q-td"+(e.autoWidth===!0?" q-table--col-auto-width":"")+(e.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(e.props===void 0)return x("td",{class:i.value},N(a.default));const s=l.vnode.key,d=(e.props.colsMap!==void 0?e.props.colsMap[s]:null)||e.props.col;if(d===void 0)return;const{row:v}=e.props;return x("td",{class:i.value+d.__tdClass(v),style:d.__tdStyle(v)},N(a.default))}}}),Y=K({name:"QTooltip",inheritAttrs:!1,props:F(j(j(j({},pt),$e),Le),{maxHeight:{type:String,default:null},maxWidth:{type:String,default:null},transitionShow:{default:"jump-down"},transitionHide:{default:"jump-up"},anchor:{type:String,default:"bottom middle",validator:be},self:{type:String,default:"top middle",validator:be},offset:{type:Array,default:()=>[14,14],validator:_t},scrollTarget:{default:void 0},delay:{type:Number,default:0},hideDelay:{type:Number,default:0}}),emits:[...Fe],setup(e,{slots:a,emit:l,attrs:i}){let s,d;const v=J(),{proxy:{$q:r}}=v,f=y(null),b=y(!1),w=P(()=>pe(e.anchor,r.lang.rtl)),C=P(()=>pe(e.self,r.lang.rtl)),q=P(()=>e.persistent!==!0),{registerTick:S,removeTick:Q}=We(),{registerTimeout:V,removeTimeout:E}=ze(),{transition:A,transitionStyle:k}=Ge(e,b),{localScrollTarget:u,changeScrollEvent:t,unconfigureScrollTarget:c}=gt(e,ae),{anchorEl:p,canShow:qe,anchorEvents:R}=ht({showing:b,configureAnchorEl:Be}),{show:Ee,hide:$}=Xe({showing:b,canShow:qe,handleShow:Oe,handleHide:Pe,hideOnRouteChange:q,processOnMount:!0});Object.assign(R,{delayShow:Ae,delayHide:De});const{showPortal:te,hidePortal:oe,renderPortal:Qe}=Ye(v,f,Ue);if(r.platform.is.mobile===!0){const m={anchorEl:p,innerRef:f,onClickOutside(D){return $(D),D.target.classList.contains("q-dialog__backdrop")&&et(D),!0}},L=P(()=>e.modelValue===null&&e.persistent!==!0&&b.value===!0);re(L,D=>{(D===!0?wt:_e)(m)}),ue(()=>{_e(m)})}function Oe(m){Q(),E(),te(),S(()=>{d=new MutationObserver(()=>U()),d.observe(f.value,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),U(),ae()}),s===void 0&&(s=re(()=>r.screen.width+"|"+r.screen.height+"|"+e.self+"|"+e.anchor+"|"+r.lang.rtl,U)),V(()=>{te(!0),l("show",m)},e.transitionDuration)}function Pe(m){Q(),E(),oe(),le(),V(()=>{oe(!0),l("hide",m)},e.transitionDuration)}function le(){d!==void 0&&(d.disconnect(),d=void 0),s!==void 0&&(s(),s=void 0),c(),ce(R,"tooltipTemp")}function U(){const m=f.value;p.value===null||!m||yt({el:m,offset:e.offset,anchorEl:p.value,anchorOrigin:w.value,selfOrigin:C.value,maxHeight:e.maxHeight,maxWidth:e.maxWidth})}function Ae(m){if(r.platform.is.mobile===!0){ge(),document.body.classList.add("non-selectable");const L=p.value,D=["touchmove","touchcancel","touchend","click"].map(ne=>[L,ne,"delayHide","passiveCapture"]);de(R,"tooltipTemp",D)}V(()=>{Ee(m)},e.delay)}function De(m){E(),r.platform.is.mobile===!0&&(ce(R,"tooltipTemp"),ge(),setTimeout(()=>{document.body.classList.remove("non-selectable")},10)),V(()=>{$(m)},e.hideDelay)}function Be(){if(e.noParentEvent===!0||p.value===null)return;const m=r.platform.is.mobile===!0?[[p.value,"touchstart","delayShow","passive"]]:[[p.value,"mouseenter","delayShow","passive"],[p.value,"mouseleave","delayHide","passive"]];de(R,"anchor",m)}function ae(){if(p.value!==null||e.scrollTarget!==void 0){u.value=Ze(p.value,e.scrollTarget);const m=e.noParentEvent===!0?U:$;t(u.value,m)}}function Re(){return b.value===!0?x("div",F(j({},i),{ref:f,class:["q-tooltip q-tooltip--style q-position-engine no-pointer-events",i.class],style:[i.style,k.value],role:"complementary"}),N(a.default)):null}function Ue(){return x(Je,{name:A.value,appear:!0},Re)}return ue(le),Object.assign(v.proxy,{updatePosition:U}),Qe}}),Z=K({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","before-show","show","before-hide","hide"],setup(e,{slots:a,emit:l}){const{proxy:i}=J(),{$q:s}=i,d=y(null),v=y(""),r=y("");let f=!1;const b=P(()=>{const t={initialValue:v.value,validate:e.validate,set:w,cancel:C,updatePosition:q};return tt(t,"value",()=>r.value,c=>{r.value=c}),t});function w(){e.validate(r.value)!==!1&&(S()===!0&&(l("save",r.value,v.value),l("update:modelValue",r.value)),Q())}function C(){S()===!0&&l("cancel",r.value,v.value),Q()}function q(){lt(()=>{d.value.updatePosition()})}function S(){return ot(r.value,v.value)===!1}function Q(){f=!0,d.value.hide()}function V(){f=!1,v.value=H(e.modelValue),r.value=H(e.modelValue),l("before-show")}function E(){l("show")}function A(){f===!1&&S()===!0&&(e.autoSave===!0&&e.validate(r.value)===!0?(l("save",r.value,v.value),l("update:modelValue",r.value)):l("cancel",r.value,v.value)),l("before-hide")}function k(){l("hide")}Object.assign(i,{set:w,cancel:C,show(t){d.value!==null&&d.value.show(t)},hide(t){d.value!==null&&d.value.hide(t)},updatePosition:q});function u(){const t=a.default!==void 0?[].concat(a.default(b.value)):[];return e.title&&t.unshift(x("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},e.title)),e.buttons===!0&&t.push(x("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[x(B,{flat:!0,color:e.color,label:e.labelCancel||s.lang.label.cancel,onClick:C}),x(B,{flat:!0,color:e.color,label:e.labelSet||s.lang.label.set,onClick:w})])),t}return()=>{if(e.disable!==!0)return x(kt,{ref:d,class:"q-popup-edit",cover:e.cover,onBeforeShow:V,onShow:E,onBeforeHide:A,onHide:k,onEscapeKey:C},u)}}});const Et=["top","middle","bottom"];var Qt=K({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>Et.includes(e)}},setup(e,{slots:a}){const l=P(()=>e.align!==void 0?{verticalAlign:e.align}:null),i=P(()=>{const s=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(s!==void 0?` text-${s}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>x("div",{class:i.value,style:l.value,role:"alert","aria-label":e.label},at(a.default,e.label!==void 0?[e.label]:[]))}}),Ot=K({name:"QTr",props:{props:Object,noHover:Boolean},setup(e,{slots:a}){const l=P(()=>"q-tr"+(e.props===void 0||e.props.header===!0?"":" "+e.props.__trClass)+(e.noHover===!0?" q-tr--no-hover":""));return()=>x("tr",{class:l.value},N(a.default))}});function he(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const a=parseInt(e,10);return isNaN(a)?0:a}var ye=nt({name:"close-popup",beforeMount(e,{value:a}){const l={depth:he(a),handler(i){l.depth!==0&&setTimeout(()=>{const s=it(e);s!==void 0&&st(s,i,l.depth)})},handlerKey(i){rt(i,13)===!0&&l.handler(i)}};e.__qclosepopup=l,e.addEventListener("click",l.handler),e.addEventListener("keyup",l.handlerKey)},updated(e,{value:a,oldValue:l}){a!==l&&(e.__qclosepopup.depth=he(a))},beforeUnmount(e){const a=e.__qclosepopup;e.removeEventListener("click",a.handler),e.removeEventListener("keyup",a.handlerKey),delete e.__qclosepopup}});const Pt=e=>(ct("data-v-e2817698"),e=e(),dt(),e),At={style:{width:"700px","max-width":"80vw"}},Dt=Pt(()=>T("h4",{class:"text-center"},"Crear Ticket (OT)",-1)),Bt={class:"row"},Rt={class:"col"},Ut=h(" No hay Clientes "),jt={class:"row"},Mt={class:"col"},It=h(" No hay colaboradores "),Ht={class:"row"},Kt={class:"col"},Nt=h(" No hay dispositivos "),$t={class:"row"},Lt={class:"col"},Ft={class:"row justify-center"},Wt={__name:"FormTicket",setup(e){const{getAllClientes:a,getOnlyRuts:l}=Te(),{getAllColaboradores:i,getOnlyRutCol:s}=Se(),{getAllDispositivos:d,getOnlyIdDispositivos:v}=St(),{createTicket:r}=xe();we(async()=>{await f()}),ke(async()=>{await f()});const f=async()=>{await a(),await i(),await d()},b=l.value,w=y(null),C=s.value,q=y(null),S=y(null),Q=v.value,V=y(null),E=y(1),A=async()=>{const k={clientesRutCliente:w.value,colaboradoresRutColaborador:q.value,dispositivosIdDispositivo:S.value,problema_ticket:V.value,estado_ticket:E.value};await r(k)};return(k,u)=>(ee(),Ce("div",At,[o(Ve,{class:"q-pa-sm"},{default:n(()=>[Dt,o(Tt,{onSubmit:A},{default:n(()=>[T("div",Bt,[T("div",Rt,[o(z,{modelValue:w.value,"onUpdate:modelValue":u[0]||(u[0]=t=>w.value=t),outlined:"","use-input":"","input-debounce":"0",label:"Elija un cliente",options:g(b),behavior:"menu",onFilter:k.filterFn},{"no-option":n(()=>[o(G,null,{default:n(()=>[o(X,{class:"text-grey"},{default:n(()=>[Ut]),_:1})]),_:1})]),append:n(()=>[o(I,{name:"person",color:"black"})]),_:1},8,["modelValue","options","onFilter"])])]),T("div",jt,[T("div",Mt,[o(z,{modelValue:q.value,"onUpdate:modelValue":u[1]||(u[1]=t=>q.value=t),outlined:"","use-input":"","input-debounce":"0",label:"Colaborador que atiende",options:g(C),behavior:"menu"},{"no-option":n(()=>[o(G,null,{default:n(()=>[o(X,{class:"text-grey"},{default:n(()=>[It]),_:1})]),_:1})]),append:n(()=>[o(I,{name:"support_agent",color:"black"})]),_:1},8,["modelValue","options"])])]),T("div",Ht,[T("div",Kt,[o(z,{modelValue:S.value,"onUpdate:modelValue":u[2]||(u[2]=t=>S.value=t),outlined:"","use-input":"","input-debounce":"0",label:"Dispositivo a reparar",options:g(Q),behavior:"menu"},{"no-option":n(()=>[o(G,null,{default:n(()=>[o(X,{class:"text-grey"},{default:n(()=>[Nt]),_:1})]),_:1})]),append:n(()=>[o(I,{name:"devices_other",color:"black"})]),_:1},8,["modelValue","options"])])]),T("div",$t,[T("div",Lt,[o(M,{modelValue:V.value,"onUpdate:modelValue":u[3]||(u[3]=t=>V.value=t),label:"Describa el problema... *",type:"textarea",outlined:""},null,8,["modelValue"])])]),T("div",Ft,[o(B,{label:"Agregar",type:"submit",color:"primary"})])]),_:1})]),_:1})]))}};var zt=ut(Wt,[["__scopeId","data-v-e2817698"]]);const Gt={class:"q-pa-md"},Xt={class:"q-ml-sm"},Yt={class:"text-pre-wrap"},Zt={__name:"TableEdit",setup(e){const{isAdmin:a}=qt(),{getClienteByRut:l}=Te(),{getAllColaboradores:i,getColabByRut:s}=Se(),{getAllTickets:d,deleteTicket:v,getTickets:r}=xe();let f=y(!1),b=y(!1),w=y(null);const C=y(""),q=()=>{f.value=!f.value},S=k=>{w.value=k,b.value=!b.value},Q=[{name:"id_ticket",align:"center",label:"ID Ticket",field:"ticket",sortable:!0},{name:"clientesRutCliente",align:"center",label:"Cliente",field:"clienteAtendido",sortable:!0},{name:"colaboradoresRutColaborador",align:"center",label:"Qui\xE9n Atendi\xF3",field:"colaboradorAtiende",sortable:!0},{name:"dispositivosIdDispositivo",align:"center",label:"Dispositivo",field:"dispositivoAtendido",sortable:!0},{name:"problema_ticket",align:"center",label:"Problema",field:"problemaTicket",sortable:!0},{name:"diagnostico_ticket",align:"center",label:"Dign\xF3stico",field:"diagnosticoTicket",sortable:!0},{name:"resolucion_ticket",align:"center",label:"Resoluci\xF3n",field:"resolucionTicket",sortable:!0},{name:"estado_ticket",align:"center",label:"Estado",field:"estadoTicket",sortable:!0},{name:"acciones",label:"Acciones",field:"acciones",align:"center"}],V=async k=>{a?(console.log("delete permitido",k),await v(k)):(console.log("no hay permisos"),xt("No tiene permisos de Administrador para eliminar","negative"))},E=[{estado:"Abierto",color:"green"},{estado:"En Progreso",color:"yellow"},{estado:"Terminado",color:"blue"},{estado:"Cancelado",color:"red"}],A=async()=>{await d(),await i()};return we(async()=>{await A()}),ke(async()=>{await A()}),(k,u)=>(ee(),Ce("div",Gt,[o(Vt,{title:"Administraci\xF3n de Tickets",rows:g(r),columns:Q,filter:C.value,"row-key":"name","binary-state-sort":""},{top:n(()=>[o(fe,{modelValue:g(f),"onUpdate:modelValue":u[0]||(u[0]=t=>ve(f)?f.value=t:f=t)},{default:n(()=>[o(zt)]),_:1},8,["modelValue"]),o(fe,{modelValue:g(b),"onUpdate:modelValue":u[2]||(u[2]=t=>ve(b)?b.value=t:b=t),persistent:""},{default:n(()=>[o(Ve,{class:""},{default:n(()=>[o(ft,{class:"row items-center"},{default:n(()=>[o(vt,{icon:"warning",color:"warning","text-color":"white"}),T("span",Xt,"\xBFEst\xE1s seguro de eliminar el ticket n\xBA "+_(g(w))+"?",1)]),_:1}),o(mt,{align:"right"},{default:n(()=>[me(o(B,{flat:"",label:"Cancelar",color:"primary"},null,512),[[ye]]),me(o(B,{flat:"",label:"Confirmar",color:"negative",onClick:u[1]||(u[1]=t=>V(g(w)))},null,512),[[ye]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(B,{color:"primary",label:"A\xF1adir Ticket",icon:"add",onClick:q}),o(Ct),o(M,{modelValue:C.value,"onUpdate:modelValue":u[3]||(u[3]=t=>C.value=t),borderless:"",outlined:"",dense:"",debounce:"300",color:"primary"},{append:n(()=>[o(I,{name:"search"})]),_:1},8,["modelValue"])]),body:n(t=>[o(Ot,{props:t},{default:n(()=>[o(O,{key:"id_ticket",props:t},{default:n(()=>[h(_(t.row.id_ticket),1)]),_:2},1032,["props"]),o(O,{key:"clientesRutCliente",props:t},{default:n(()=>[h(_(t.row.clientesRutCliente)+" ",1),o(Y,null,{default:n(()=>[h(_(g(l)(t.row.clientesRutCliente).nombre_cliente)+" "+_(g(l)(t.row.clientesRutCliente).appat_cliente)+" "+_(g(l)(t.row.clientesRutCliente).apmat_cliente),1)]),_:2},1024)]),_:2},1032,["props"]),o(O,{key:"colaboradoresRutColaborador",props:t},{default:n(()=>[T("div",Yt,[h(_(t.row.colaboradoresRutColaborador)+" ",1),o(Y,null,{default:n(()=>[h(_(g(s)(t.row.colaboradoresRutColaborador).nombre_colaborador)+" "+_(g(s)(t.row.colaboradoresRutColaborador).appat_colaborador)+" "+_(g(s)(t.row.colaboradoresRutColaborador).apmat_colaborador),1)]),_:2},1024)])]),_:2},1032,["props"]),o(O,{key:"dispositivosIdDispositivo",props:t},{default:n(()=>[h(_(t.row.dispositivos.num_serie_dispositivo)+" ",1),o(Y,null,{default:n(()=>[h(_(t.row.dispositivos.modelo),1)]),_:2},1024)]),_:2},1032,["props"]),o(O,{key:"problema_ticket",props:t},{default:n(()=>[h(_(t.row.problema_ticket)+" ",1),o(Z,{modelValue:t.row.problema_ticket,"onUpdate:modelValue":c=>t.row.problema_ticket=c,title:"Editar problema","auto-save":""},{default:n(c=>[o(M,{modelValue:c.value,"onUpdate:modelValue":p=>c.value=p,dense:"",autofocus:"",counter:"",onKeyup:W(c.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),o(O,{key:"diagnostico_ticket",props:t},{default:n(()=>[h(_(t.row.diagnostico_ticket)+" ",1),o(Z,{modelValue:t.row.diagnostico_ticket,"onUpdate:modelValue":c=>t.row.diagnostico_ticket=c,title:"Editar diagn\xF3stico","auto-save":""},{default:n(c=>[o(M,{modelValue:c.value,"onUpdate:modelValue":p=>c.value=p,dense:"",autofocus:"",counter:"",onKeyup:W(c.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),o(O,{key:"resolucion_ticket",props:t},{default:n(()=>[h(_(t.row.resolucion_ticket)+" ",1),o(Z,{modelValue:t.row.resolucion_ticket,"onUpdate:modelValue":c=>t.row.resolucion_ticket=c,title:"Editar resoluci\xF3n","auto-save":""},{default:n(c=>[o(M,{modelValue:c.value,"onUpdate:modelValue":p=>c.value=p,dense:"",autofocus:"",counter:"",onKeyup:W(c.set,["enter"])},null,8,["modelValue","onUpdate:modelValue","onKeyup"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["props"]),o(O,{key:"estado_ticket",props:t},{default:n(()=>[o(Qt,{color:E[t.row.estado_ticket-1].color},{default:n(()=>[h(_(E[t.row.estado_ticket-1].estado),1)]),_:2},1032,["color"])]),_:2},1032,["props"]),o(O,{key:"acciones",props:t},{default:n(()=>[o(B,{push:"",round:"",color:"red",onClick:c=>S(t.row.id_ticket)},{default:n(()=>[o(I,{name:"delete"})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","filter"])]))}},fo={__name:"TicketsPage",setup(e){return(a,l)=>(ee(),bt(Ne,null,{default:n(()=>[o(Zt)]),_:1}))}};export{fo as default};
